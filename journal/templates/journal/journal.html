{% extends "base.html" %}
{% load static %}
{% block content %}
<script src="{% static 'js/journal.js' %}" defer></script>
<link rel="stylesheet" href="{% static 'css/journal.css' %}">

<div class="max-w-4xl mx-auto py-8 px-4">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-3xl font-bold text-indigo-600">📝 My Journal</h1>
    <button id="new-entry-btn"
            class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded-lg shadow transition" data-save-url="{% url 'journal:save_note' %}">
      + New Entry
    </button>
  </div>

  <!-- Notes List -->
  <div id="notes-list" class="space-y-6">
    {% for note in notes %}
      <div id="note-{{ note.id }}" class="bg-white rounded-xl shadow p-5 border-l-4 {% if note.pinned %}border-yellow-500{% else %}border-indigo-500{% endif %}">
        <!-- Title + Date + Pin -->
        <div class="flex justify-between items-center mb-2">
          <h2 class="text-xl font-semibold text-gray-800">{{ note.title }}</h2>
          <div class="flex items-center gap-3">
            <span class="text-sm text-gray-500">{{ note.updated_at|date:"M d, Y H:i" }}</span>
            <button onclick="togglePin({{ note.id }})" 
                    class="text-lg {% if note.pinned %}text-yellow-500{% else %}text-gray-400{% endif %}">
              📌
            </button>
          </div>
        </div>


      <!-- Content -->
      <div id="note-content-{{ note.id }}" 
          class="note-content prose prose-indigo max-w-none text-gray-700 cursor-pointer"
          onclick="expandNote({{ note.id }}, event)">
        <div class="note-preview">{{ note.content|truncatechars:200 }}</div>
        <div class="note-full hidden">{{ note.rendered_html|safe }}</div>
      </div>



        <!-- Tags -->
        {% if note.tags.exists %}
        <div class="mt-3 flex flex-wrap gap-2">
          {% for tag in note.tags.all %}
            <span class="px-2 py-1 text-xs bg-indigo-100 text-indigo-700 rounded">{{ tag.name }}</span>
          {% endfor %}
        </div>
        {% endif %}

        <!-- Actions -->
        <div class="mt-4 flex gap-4 text-sm">
          <button onclick="editNote({{ note.id }})" class="text-gray-600 hover:underline">Edit</button>
          <button onclick="deleteNote({{ note.id }})" class="text-red-500 hover:underline">Delete</button>
        </div>
      </div>
    {% empty %}
      <p class="text-gray-500 text-lg">No journal entries yet. Start writing one!</p>
    {% endfor %}
  </div>
</div>

<!-- Hidden Form Modal -->
<div id="note-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
  <div class="bg-white w-full max-w-lg rounded-lg shadow-lg p-6 relative">
    <h2 id="modal-title" class="text-xl font-semibold text-gray-800 mb-4">New Entry</h2>
    <form id="note-form">
      {% csrf_token %}
      {{ form.as_p }}
      <input type="hidden" name="note_id" id="note-id">
      <div class="mt-4 flex justify-end gap-2">
        <button type="button" onclick="closeModal()" class="px-4 py-2 rounded bg-gray-200">Cancel</button>
        <button type="submit" class="px-4 py-2 rounded bg-indigo-600 text-white">Save</button>
      </div>
    </form>
  </div>
</div>

{% endblock %}
