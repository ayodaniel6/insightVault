{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block content %}
<div class="flex min-h-screen">

  <!-- Feeds Column (3/4) -->
  <div class="w-3/4 p-4 bg-gray-50 border-r border-gray-200 overflow-y-auto">
    <h1 class="text-2xl font-semibold mb-4">Your Feeds</h1>
    <div id="feedsList" class="space-y-4">
      <div class="p-3 bg-white rounded-lg shadow-sm border">
        <h3 class="text-lg font-medium">Feed Title</h3>
        <p class="text-gray-600 mt-1 text-sm">Feed content goes here...</p>
      </div>
    </div>
  </div>

  <!-- Notes Column (1/4) -->
  <div class="w-1/4 min-h-screen bg-white border-l border-gray-200 flex flex-col">
    
    <!-- Add Note Button -->
    <button id="openCreatePanel"
            class="w-full px-4 py-3 bg-indigo-500 text-white font-semibold hover:bg-indigo-600 transition">
      + Add Note
    </button>

    <!-- Notes List -->
    <div id="notesList" class="space-y-4 p-4 flex-1 overflow-y-auto">
      {% for note in notes %}
      <div data-id="{{ note.id }}" class="note-card relative p-4 bg-white rounded-lg shadow-sm border hover:shadow-md transition">

        <!-- Pin toggle -->
        <button onclick="togglePin('{{ note.id }}')"
                class="absolute top-3 left-3 text-yellow-400 hover:text-yellow-500">
          {% if note.pinned %}ğŸ“Œ{% else %}ğŸ“{% endif %}
        </button>

        <!-- Delete -->
        <button onclick="confirmDelete('{{ note.id }}')" 
                class="absolute top-3 right-3 text-gray-400 hover:text-red-500">
          ğŸ—‘
        </button>

        <!-- Preview / Expand -->
        <div class="cursor-pointer pr-8" onclick="toggleExpand(this)">
          <h3 class="text-lg font-medium">{{ note.title }}</h3>
          <p class="text-gray-600 mt-1 text-sm preview line-clamp-2">{{ note.content }}</p>
          <p class="text-xs text-gray-400 mt-2">Updated {{ note.updated_at|date:"M d, Y H:i" }}</p>
        </div>

        <!-- Inline Edit (hidden until expanded) -->
        <div class="edit-form hidden mt-3">
          <form onsubmit="submitEdit(event, '{{ note.id }}')">
            {% csrf_token %}
            <input type="text" name="title" value="{{ note.title }}" class="w-full mb-2 p-2 border rounded">
            <textarea name="content" rows="3" class="w-full p-2 border rounded">{{ note.content }}</textarea>
            <input type="text" name="tags" value="{{ note.tags }}" placeholder="tags (comma-separated)" class="w-full mt-2 p-2 border rounded">
            <label class="flex items-center mt-2 text-sm">
              <input type="checkbox" name="pinned" {% if note.pinned %}checked{% endif %} class="mr-2">
              Pinned
            </label>
            <div class="flex justify-end gap-2 mt-2">
              <button type="button" onclick="toggleExpand(this.closest('.note-card'))" class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300">Cancel</button>
              <button type="submit" class="px-3 py-1 rounded bg-indigo-500 text-white hover:bg-indigo-600">Update</button>
            </div>
          </form>
        </div>

      </div>
      {% empty %}
      <p class="text-gray-500">No notes yet. Click â€œAdd Noteâ€ to get started.</p>
      {% endfor %}
    </div>
  </div>
</div>

<!-- Slide-in Create Panel -->
<div id="createPanel" class="fixed top-0 right-0 h-full w-full max-w-md bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-50">
  <div class="p-6 flex flex-col h-full">
    <h2 class="text-xl font-semibold mb-4">New Note</h2>
    <form id="createNoteForm" class="flex flex-col flex-grow">
      {% csrf_token %}
      {{ form.as_p }}
      <div class="mt-auto flex justify-between">
        <button type="button" onclick="closeCreatePanel()" class="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300">Cancel</button>
        <button type="submit" class="px-4 py-2 rounded bg-indigo-500 text-white hover:bg-indigo-600">Save</button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50">
  <div class="bg-white rounded-xl shadow-lg w-full max-w-sm p-6">
    <h2 class="text-lg font-semibold mb-4">Delete Note</h2>
    <p class="text-gray-600 mb-6">Are you sure you want to delete this note?</p>
    <div class="flex justify-end gap-2">
      <button type="button" onclick="closeModal('deleteModal')" class="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300">Cancel</button>
      <form id="deleteForm" method="POST">{% csrf_token %}
        <button type="submit" class="px-4 py-2 rounded bg-red-500 text-white hover:bg-red-600">Delete</button>
      </form>
    </div>
  </div>
</div>

<!-- JavaScript -->
<script src="{% static 'js/journal.js' %}"></script>
{% endblock %}
